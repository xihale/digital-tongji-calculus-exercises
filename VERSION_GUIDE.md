# 版本更新指南 (Version Update Guide)

本文档说明如何更新章节版本并准备发布。

## 更新流程

### 1. 修改内容

假设你需要修改第二章的一道题目：

1. 编辑相应的题目文件（如 `第二章 导数与微分/第一节 导数的概念.typ`）
2. 保存修改

### 2. 更新版本号

打开 `versions.typ` 文件，找到对应章节的版本配置：

**场景 A：只修改题目**

如果只修改了题目（没有修改答案），更新 `CHAPTER_VERSIONS`：

```typst
// 题目版本 (Question versions for each chapter)
#let CHAPTER_VERSIONS = (
  "第一章 函数与极限": "1.0.0",
  "第二章 导数与微分": "1.0.1",  // 从 1.0.0 改为 1.0.1
  // ...
)
```

**场景 B：只修改答案**

如果只修改了答案（没有修改题目），更新 `ANSWER_VERSIONS`：

```typst
// 答案版本 (Answer versions for each chapter)
#let ANSWER_VERSIONS = (
  "第一章 函数与极限": "1.0.0",
  "第二章 导数与微分": "1.0.1",  // 从 1.0.0 改为 1.0.1
  // ...
)
```

**场景 C：同时修改题目和答案**

如果同时修改了题目和答案，更新两处：

```typst
// 题目版本
#let CHAPTER_VERSIONS = (
  "第二章 导数与微分": "1.1.0",  // 更新版本
  // ...
)

// 答案版本
#let ANSWER_VERSIONS = (
  "第二章 导数与微分": "1.1.0",  // 更新版本
  // ...
)
```

### 3. 版本号递增规则

根据修改的性质选择版本号：

- **修订号 (+0.0.1)**：小修改
  - 修正错别字
  - 格式调整
  - 修正明显的计算错误
  
- **次版本号 (+0.1.0)**：内容更新
  - 新增题目
  - 修改题目内容
  - 更新答案解析
  
- **主版本号 (+1.0.0)**：重大变更
  - 章节重组
  - 大量题目替换
  - 结构性改变

### 4. 提交变更

提交代码时在 commit message 中说明：

```bash
git add .
git commit -m "更新第二章导数与微分题目 - 修正第3题错误 (v1.0.0 -> v1.0.1)"
```

### 5. 检查版本

使用辅助脚本检查当前所有版本：

```bash
python3 check_versions.py
```

输出示例：
```
============================================================
当前版本信息
============================================================

章节题目版本:
  第一章 函数与极限: 1.0.0
  第二章 导数与微分: 1.0.1
  ...

主文件版本 (自动): 1.0.1
```

### 6. 编译测试

编译主文件确认版本显示正确：

```bash
# 编译不带答案版本
typst compile index.typ test.pdf

# 编译带答案版本
typst compile --input SHOW_ANSWER=true index.typ test_with_answers.pdf
```

检查：
- 封面显示的主文件版本是否正确（应该是所有章节中最新的版本）
- 第二章标题下是否显示了更新后的版本号

### 7. 准备 Release

发布新版本时，只需上传：

1. **主文件 PDF**：`高等数学习题册上册.pdf` 和 `高等数学习题册上册_带答案.pdf`
2. **版本有变化的章节 PDF**：只编译和上传版本号有更新的章节

例如，如果只有第二章更新了版本，发布时上传：
- 主文件 PDF（2个：带答案和不带答案）
- 第二章 PDF（2个：带答案和不带答案）

## 完整示例

假设要为第三章新增一道题目：

1. 编辑 `第三章 微分中值定理与导数的应用/第一节 微分中值定理.typ`
2. 新增题目内容
3. 编辑 `versions.typ`，更新版本号：
   ```typst
   #let CHAPTER_VERSIONS = (
     "第三章 微分中值定理与导数的应用": "1.1.0",  // 1.0.0 -> 1.1.0
     // ...
   )
   ```
4. 提交：
   ```bash
   git add .
   git commit -m "第三章新增一道微分中值定理题目 (v1.0.0 -> v1.1.0)"
   ```
5. 检查版本：
   ```bash
   python3 check_versions.py
   ```
6. 编译测试：
   ```bash
   typst compile index.typ 高等数学习题册上册.pdf
   ```
7. 发布 Release 时上传主文件和第三章的 PDF

## 注意事项

1. **版本一致性**：如果同时修改题目和答案，建议两个版本号保持一致
2. **主版本自动**：不需要手动设置主文件版本，它会自动使用所有章节中最新的版本号
3. **Release 精简**：只上传有更新的章节，不要每次都上传所有章节
4. **文档同步**：如果修改了 README 或其他文档，也要在 git commit 中说明
